-- V1__create_initial_tables.sql

-- Criação de Sequências para Entidades que usam GenerationType.SEQUENCE ou similar
CREATE SEQUENCE IF NOT EXISTS employee_seq START WITH 1 INCREMENT BY 50;
CREATE SEQUENCE IF NOT EXISTS invoice_seq START WITH 1 INCREMENT BY 50;
CREATE SEQUENCE IF NOT EXISTS part_seq START WITH 1 INCREMENT BY 50;
CREATE SEQUENCE IF NOT EXISTS repair_service_seq START WITH 1 INCREMENT BY 50;

-- Tabela de Endereços
CREATE TABLE addresses (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    street VARCHAR(200),
    city VARCHAR(100),
    state VARCHAR(50),
    zip_code VARCHAR(20),
    neighborhood VARCHAR(100),
    number VARCHAR(20),
    complement VARCHAR(100)
);

-- Tabela de Clientes
CREATE TABLE clients (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    tenant_id VARCHAR(255) NOT NULL,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    phone VARCHAR(255) NOT NULL UNIQUE,
    cpf VARCHAR(11) NOT NULL UNIQUE,
    address_id BIGINT UNIQUE,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by VARCHAR(255),
    updated_by VARCHAR(255),
    CONSTRAINT fk_clients_address FOREIGN KEY (address_id) REFERENCES addresses(id)
);

-- Tabela de Funcionários
CREATE TABLE employee (
    id BIGINT PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    tenant_id VARCHAR(255) NOT NULL,
    name VARCHAR(100) NOT NULL,
    role VARCHAR(255) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    phone VARCHAR(255) NOT NULL UNIQUE,
    cpf VARCHAR(11) NOT NULL UNIQUE,
    address_id BIGINT UNIQUE,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by VARCHAR(255),
    updated_by VARCHAR(255),
    CONSTRAINT fk_employee_address FOREIGN KEY (address_id) REFERENCES addresses(id)
);

-- Tabela de Peças
CREATE TABLE part (
    id BIGINT PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    tenant_id VARCHAR(255) NOT NULL,
    name VARCHAR(100) NOT NULL,
    description VARCHAR(500),
    price NUMERIC(10, 2) NOT NULL,
    code VARCHAR(100) UNIQUE,
    supplier VARCHAR(100),
    buy_date TIMESTAMP,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by VARCHAR(255),
    updated_by VARCHAR(255)
);

-- Tabela de Serviços de Reparo
CREATE TABLE repair_service (
    id BIGINT PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    tenant_id VARCHAR(255) NOT NULL,
    name VARCHAR(100) NOT NULL,
    description VARCHAR(500),
    cost NUMERIC(10, 2) NOT NULL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by VARCHAR(255),
    updated_by VARCHAR(255)
);

-- Tabela de Veículos
CREATE TABLE vehicles (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    tenant_id VARCHAR(255) NOT NULL,
    year INT NOT NULL,
    license_plate VARCHAR(255) NOT NULL UNIQUE,
    model VARCHAR(255) NOT NULL,
    color VARCHAR(255) NOT NULL,
    brand VARCHAR(255) NOT NULL,
    client_id BIGINT NOT NULL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by VARCHAR(255),
    updated_by VARCHAR(255),
    CONSTRAINT fk_vehicles_client FOREIGN KEY (client_id) REFERENCES clients(id)
);

-- Tabela de Usuários
CREATE TABLE users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    tenant_id VARCHAR(255) NOT NULL,
    password VARCHAR(200) NOT NULL,
    full_name VARCHAR(100),
    email VARCHAR(150) NOT NULL UNIQUE,
    phone VARCHAR(20),
    role VARCHAR(25) NOT NULL,
    status VARCHAR(255) NOT NULL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by VARCHAR(255),
    updated_by VARCHAR(255)
);

-- Tabela de Orçamentos
CREATE TABLE quotations (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    tenant_id VARCHAR(255) NOT NULL,
    description VARCHAR(300),
    status SMALLINT NOT NULL,
    total_cost NUMERIC(38, 2) NOT NULL,
    entry_date TIMESTAMP NOT NULL,
    exit_date TIMESTAMP,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by VARCHAR(255),
    updated_by VARCHAR(255),
    vehicle_id BIGINT NOT NULL,
    client_id BIGINT NOT NULL,
    service_order_id BIGINT,
    CONSTRAINT fk_quotations_vehicle FOREIGN KEY (vehicle_id) REFERENCES vehicles(id),
    CONSTRAINT fk_quotations_client FOREIGN KEY (client_id) REFERENCES clients(id)
);

-- Tabela de Ordens de Serviço
CREATE TABLE service_order (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    tenant_id VARCHAR(255) NOT NULL,
    entry_date TIMESTAMP NOT NULL,
    exit_date TIMESTAMP,
    status VARCHAR(255) NOT NULL,
    description VARCHAR(500),
    total_cost NUMERIC(38, 2),
    quotation_id BIGINT UNIQUE,
    vehicle_id BIGINT NOT NULL,
    client_id BIGINT NOT NULL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by VARCHAR(255),
    updated_by VARCHAR(255),
    CONSTRAINT fk_service_order_quotation FOREIGN KEY (quotation_id) REFERENCES quotations(id),
    CONSTRAINT fk_service_order_vehicle FOREIGN KEY (vehicle_id) REFERENCES vehicles(id),
    CONSTRAINT fk_service_order_client FOREIGN KEY (client_id) REFERENCES clients(id)
);

-- Tabela de Faturas
CREATE TABLE invoice (
    id BIGINT PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    tenant_id VARCHAR(255) NOT NULL,
    invoice_number VARCHAR(255) NOT NULL UNIQUE,
    issue_date TIMESTAMP NOT NULL,
    total_amount NUMERIC(38, 2) NOT NULL,
    payment_status VARCHAR(255) NOT NULL,
    payment_date TIMESTAMP,
    serviceorder_id BIGINT NOT NULL UNIQUE,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by VARCHAR(255),
    updated_by VARCHAR(255),
    CONSTRAINT fk_invoice_service_order FOREIGN KEY (serviceorder_id) REFERENCES service_order(id)
);


-- Tabelas de Itens e Junções

CREATE TABLE quotation_part_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    quotation_id BIGINT NOT NULL,
    part_id BIGINT NOT NULL,
    quantity INT NOT NULL,
    unit_price NUMERIC(10, 2) NOT NULL,
    CONSTRAINT fk_qpi_quotation FOREIGN KEY (quotation_id) REFERENCES quotations(id),
    CONSTRAINT fk_qpi_part FOREIGN KEY (part_id) REFERENCES part(id)
);

CREATE TABLE quotation_service_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    quotation_id BIGINT NOT NULL,
    repair_service_id BIGINT NOT NULL,
    service_cost NUMERIC(10, 2) NOT NULL,
    CONSTRAINT fk_qsi_quotation FOREIGN KEY (quotation_id) REFERENCES quotations(id),
    CONSTRAINT fk_qsi_repair_service FOREIGN KEY (repair_service_id) REFERENCES repair_service(id)
);

CREATE TABLE service_order_part_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    service_order_id BIGINT NOT NULL,
    part_id BIGINT NOT NULL,
    quantity INT NOT NULL,
    unit_price NUMERIC(10, 2) NOT NULL,
    CONSTRAINT fk_sopi_service_order FOREIGN KEY (service_order_id) REFERENCES service_order(id),
    CONSTRAINT fk_sopi_part FOREIGN KEY (part_id) REFERENCES part(id)
);

CREATE TABLE service_order_service_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    service_order_id BIGINT NOT NULL,
    repair_service_id BIGINT NOT NULL,
    service_cost NUMERIC(10, 2) NOT NULL,
    CONSTRAINT fk_sosi_service_order FOREIGN KEY (service_order_id) REFERENCES service_order(id),
    CONSTRAINT fk_sosi_repair_service FOREIGN KEY (repair_service_id) REFERENCES repair_service(id)
);

CREATE TABLE service_order_employees (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    deleted BOOLEAN NOT NULL,
    service_order_id BIGINT NOT NULL,
    employee_id BIGINT NOT NULL,
    worked_hours NUMERIC(10, 2),
    commission_percentage INTEGER,
    CONSTRAINT fk_soe_service_order FOREIGN KEY (service_order_id) REFERENCES service_order(id),
    CONSTRAINT fk_soe_employee FOREIGN KEY (employee_id) REFERENCES employee(id)
);